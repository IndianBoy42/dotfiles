"$schema" = "https://jj-vcs.github.io/jj/latest/config-schema.json"

[user]
name = "Anshuman Medhi"
email = "rohanmed123@gmail.com"

[aliases]
tug = ["bookmark", "move", "--from", "heads(::@- & bookmarks())", "--to", "@-"]
rebase-all = ["rebase", "-s", "all:roots(trunk()..mutable())", "-d", "trunk()"]
jj = []
# l = ["log", "-r", "ancestors(reachable(@, mutable()), 2)"]
ws = ["workspace"]
e = ["edit"]
n = ["new"]
d = ["diff"]
s = ["show"]
ll = ["log", "-T", "builtin_log_detailed"]
nt = ["new", "trunk()"]
credit = ["file", "annotate"]              # blame but nice
init = ["git", "init", "--colocate"]
clone = ["git", "clone", "--colocate"]
cma = ["commit", "-m"]
c = ["commit"]
conflicts = ["resolve", "-l"]
re = ["resolve"]
bm = ["bookmark"]
dup = ["duplicate"]

# [colors]
# "diff removed token" = { fg = "bright red", bg = "#400000", underline = false }
# "diff added token" = { fg = "bright green", bg = "#003000", underline = false }
[colors]
# Core Metadata
"commit_id" = { fg = "#61afef" } # Blue
"change_id" = { fg = "#c678dd" } # Magenta
"author" = { fg = "#e5c07b" }    # Yellow
"date" = { fg = "#56b6c2" }      # Cyan
"email" = { fg = "#5c6370" }     # Grey
"empty" = { fg = "#5c6370" }     # Grey [[1]](https://github.com/idursun/jjui/releases)

# Branches & Tags
"branches" = { fg = "#98c379" }        # Green
"remote_branches" = { fg = "#e06c75" } # Red
"tags" = { fg = "#e5c07b" }            # Yellow
"bookmarks" = { fg = "#61afef" }       # Blue [[1]](https://github.com/idursun/jjui/releases)

# Diffs
"diff.add" = { fg = "#98c379" }                 # Green
"diff.remove" = { fg = "#e06c75" }              # Red
"diff.header" = { fg = "#abb2bf", bold = true } # Foreground
"diff.hunk_header" = { fg = "#61afef" }         # Blue [[1]](https://github.com/idursun/jjui/releases)

# Working Copy Status
"working_copy" = { fg = "#98c379", bold = true }
"working_copy change_id" = { fg = "#98c379", bold = true }

# Graph Elements
"node" = { fg = "#abb2bf" }
"node working_copy" = { fg = "#e06c75", bold = true }
"rest" = { fg = "#5c6370" }                           # Grey (elided items)

[ui]
merge-editor = "smerge"
diff-editor = ["nvim", "-c", "DiffEditor $left $right $output"]

[merge-tools.nvim2]
program = "nvim"
merge-args = [
    "-c",
    "let g:jj_diffconflicts_marker_length=$marker_length",
    "-c",
    "JJDiffConflicts!",
    "$output",
    "$base",
    "$left",
    "$right",
]
merge-tool-edits-conflict-markers = true

[revsets]

[revset-aliases]
# Useful on Windows. Technically conflicts with any bookmark/tag named 'at', but
# seems OK...
'at' = '@'
"p(n)" = "p(@, n)"
"p(r, n)" = "roots(r | ancestors(r-, n))"

till_trunk = '(trunk()..@) | trunk()'
all_till_trunk = '(trunk()..bookmarks()) | trunk()'

till_tags = '(tags()..@) | tags()'
all_till_tags = '(tags()..bookmarks()) | tags()'

# FIXME (upstream): should this be upstream?
'user(x)' = 'author(x) | committer(x)'

# By default, show the repo trunk, the remote bookmarks, and all remote tags. We
# don't want to change these in most cases, but in some repos it's useful.
# 'immutable_heads()' = 'present(trunk()) | untracked_remote_bookmarks() | tags()'

'why_immutable(r)' = 'r | roots(r:: & immutable_heads())'

# Useful to ignore this, in many repos. For repos like `jj` these are
# consistently populated with a bunch of auto-generated commits, so ignoring it
# is often nice.
'gh_pages()' = 'ancestors(remote_bookmarks(exact:"gh-pages"))'

# trunk() by default resolves to the latest 'main'/'master' remote bookmark. May
# require customization for repos like nixpkgs.
'trunk()' = 'latest((present(main) | present(master)) & remote_bookmarks())'

# Private and WIP commits that should never be pushed anywhere. Often part of
# work-in-progress merge stacks.
'wip()' = 'description(glob:"wip:*")'
'private()' = 'description(glob:"private:*")'
'blacklist()' = 'wip() | private()'

# stack(x, n) is the set of mutable commits reachable from 'x', with 'n'
# parents. 'n' is often useful to customize the display and return set for
# certain operations. 'x' can be used to target the set of 'roots' to traverse,
# e.g. @ is the current stack.
'stack()' = 'ancestors(reachable(@, mutable()), 2)'
'stack(x)' = 'ancestors(reachable(x, mutable()), 2)'
'stack(x, n)' = 'ancestors(reachable(x, mutable()), n)'

# The current set of "open" works. It is defined as:
#
# - given the set of commits not in trunk, that are written by me,
# - calculate the given stack() for each of those commits
#
# n = 1, meaning that nothing from `trunk()` is included, so all resulting
# commits are mutable by definition.
'open()' = 'stack(trunk().. & mine(), 1)'

# the set of 'ready()' commits. defined as the set of open commits, but nothing
# that is blacklisted or any of their children.
#
# often used with gerrit, which you can use to submit whole stacks at once:
#
# - jj gerrit send -r 'ready()' --dry-run
'ready()' = 'open() ~ blacklist()::'

log_default = "present(@) | ancestors(immutable_heads().., 2) | present(trunk())"


[gg.ui]
recent-workspaces = ["/home/anshuman/dev/fishi-h7-stable"]
